---
title: "ww_arg_3"
author: "Sooyeol Kim"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 3. Data analysis on ARG concentrations 

To be used after running the first markdown "ww_arg" which was used to produce primary and secondary datasets. 
The following code was used to analyze the ARG concentrations measured across all sewersheds. 

## 3.1 Packages needed for data analysis and plotting 
```{r r_setup, include=FALSE}
#Packages 
library(dplyr) #package for data manipulation (mutate, filter, etc)
library(ggplot2) #package for plotting 
library(tidyr) #package for tidy data 
library(GGally) #extension for ggplot2 for additional functionality
library(corrplot) #package for correlation matrix
library(conover.test) #package for conover-iman test 
library(gridExtra) #package for arranging plots
library(stats) #package for p-value corrections

```

## 3.2 Correlation among ARGs 

Construct a correlation matrix to look at correlation among ARGs. First, we'll do it with individual normalized concentrations. p-value adjustment not applied since we expect these concentrations to correlate. 

```{r corrplot_conc, fig.width = 4, fig.height = 4}
#Wide data frame for ARG concentrations normalized by 16S
data_11_wide <- data_all_3 %>% 
  select (site, plant, city, state, population, zipcode, fips, mean_ARG_S, target) %>% 
  pivot_wider(names_from = target, values_from = mean_ARG_S) 

#Calculate Spearman correlation coefficients
cor_matrix <- cor(data_11_wide[,8:18],
                  use = "na.or.complete",
                  method = "spearman")

p_matrix <- cor.mtest(data_11_wide[,8:18],
                  use = "na.or.complete",
                  method = "spearman",
                  conf.level = 0.95)$p 

#Order of ARGs in the correlation plot
cor_order <- c("CMY", "CTX-M", "KPC", "MecA", "NDM", "OXA-48", "TEM", "VIM",
               "MCR-1",
               "TetW",
               "VanA")

cor_matrix_reordered <- cor_matrix[cor_order, cor_order]

p_matrix_reordered <- p_matrix[cor_order, cor_order, drop = FALSE]

#Correlation plot for ARG normalized by 16S
pdf("Fig_ARG_Corr_Conc.pdf")
corrplot(cor_matrix_reordered,
         method = "ellipse",
         type = "lower",
         tl.col = c("#4c4c4c", "#4c4c4c", "#4c4c4c", "#4c4c4c", 
                    "#4c4c4c", "#4c4c4c", "#4c4c4c", "#4c4c4c",
                    "#9a3030", 
                    "#cf9e0f", 
                    "#7B8D3C"), 
         tl.srt = 45,
         p.mat = p_matrix_reordered,
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG normalized by 16S",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()

```

Looking at correlation with individual z-scores:

```{r corrplot_z, fig.width = 4, fig.height = 4}
#Wide data frame for ARG concentrations normalized by 16S
data_all_2_wide <- data_all_2 %>% 
  select (site, plant, city, state, population, zipcode, fips, zscore, target) %>% 
  pivot_wider(names_from = target, values_from = zscore) %>%
  mutate(Total = rowSums(select(., CMY, `CTX-M`, KPC, `MCR-1`, MecA, NDM, 
                                `OXA-48`, TEM, TetW, VIM, VanA), 
                         na.rm = FALSE))

#Calculate Spearman correlation coefficients
cor_matrix_zscore <- cor(data_all_2_wide[,8:18],
                  use = "na.or.complete",
                  method = "spearman")

p_matrix_zscore <- cor.mtest(data_all_2_wide[,8:18],
                  use = "na.or.complete",
                  method = "spearman",
                  conf.level = 0.95)$p

#Order of ARGs in the correlation plot
cor_order <- c("CMY", "CTX-M", "KPC", "MecA", "NDM", "OXA-48", "TEM", "VIM",
               "MCR-1",
               "TetW",
               "VanA")

cor_matrix_zscore_reordered <- cor_matrix_zscore[cor_order, cor_order]

p_matrix_zscore_reordered <- p_matrix_zscore[cor_order, cor_order, drop = FALSE]

#Correlation plot for ARG as zscore
pdf("Fig_ARG_Corr_z.pdf")
corrplot(cor_matrix_zscore_reordered,
         method = "ellipse",
         type = "lower",
         tl.col = c("black",
                    "#4c4c4c", "#4c4c4c", "#4c4c4c", "#4c4c4c", 
                    "#4c4c4c", "#4c4c4c", "#4c4c4c", "#4c4c4c",
                    "#9a3030", 
                    "#cf9e0f", 
                    "#7B8D3C"), 
         tl.srt = 45,
         p.mat = p_matrix_zscore_reordered,
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG as zscore",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()

```

The only difference should be correlation with total count since correlation among ARGs shouldn't be affected whether the comparison is with 16S normalized vs z-scores. 

Looking at correlation when concentrations aggregated, first with sums: 

```{r corrplot_agg_conc, fig.width = 4, fig.height = 4}
#This dataset would still have outliers
#Calculate Spearman correlation coefficients
cor_matrix_burden_add <- cor(data_burden_add[,5:9],
                         use = "na.or.complete",
                         method = "spearman")

p_matrix_burden_add <- cor.mtest(data_burden_add[,5:9],
                  use = "na.or.complete",
                  method = "spearman",
                  conf.level = 0.95)$p

#Order of ARGs in the correlation plot
cor_order <- c("Burden_all", "Burden_bla", "Burden_col", "Burden_tet", "Burden_van")

cor_matrix_burden_add_reordered <- cor_matrix_burden_add[cor_order, cor_order]

p_matrix_burden_add_reordered <- p_matrix_burden_add[cor_order, cor_order]

#Correlation plot for aggregated ARG burden
pdf("Fig_ARB_Corr_Conc.pdf")
corrplot(cor_matrix_burden_add_reordered,
         method = "ellipse",
         type = "upper",
         tl.col = c("black", "#4c4c4c", "#9a3030", "#cf9e0f", "#7B8D3C"),
         tl.srt = 45, 
         p.mat = p_matrix_burden_add_reordered,
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG aggregated as sum of concentration",
         mar = c(0,0,1,0),
         cex.main = 0.8)
dev.off()

```

Looking at correlation when aggregated as z-scores: 

```{r corrplot_agg_z, fig.width = 4, fig.height = 4}
#Calculate Spearman correlation coefficients
cor_matrix_burden <- cor(data_burden_mer[,5:9],
                         use = "na.or.complete",
                         method = "spearman")

p_matrix_burden <- cor.mtest(data_burden_mer[,5:9],
                  use = "na.or.complete",
                  method = "spearman",
                  conf.level = 0.95)$p

#Order of ARGs in the correlation plot
cor_order <- c("Burden_all", "Burden_bla", "Burden_col", "Burden_tet", "Burden_van")

cor_matrix_burden_reordered <- cor_matrix_burden[cor_order, cor_order]

p_matrix_burden_reordered <- p_matrix_burden[cor_order, cor_order]

#Correlation plot for aggregated ARG burden
pdf("Fig_ARB_Corr_z.pdf")
corrplot(cor_matrix_burden_reordered,
         method = "ellipse",
         type = "upper",
         tl.col = c("black", "#4c4c4c", "#9a3030", "#cf9e0f", "#7B8D3C"), 
         tl.srt = 45,
         p.mat = p_matrix_burden_reordered,
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG aggregated as z-score",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()
```

## 3.3 Correlation with secondary data

Correlation matrix with ARG prevalence and potential determinants examined. BH correction used to limit false discovery rate. 

```{r corrplot_combined}
#Wide data frame for variables needed 
data_ARG_all <- data_burden_mer %>%
  #Take out combined themes from SVI and EJI since we have individual components as PROP_
  select(-nCT_svi, -RPL_THEME1, -RPL_THEME2, -RPL_THEME3, -RPL_THEME4, -RPL_THEMES,
         -nCT_eji, -RPL_EJI, -RPL_SER, -RPL_SVM, -RPL_EBM, -RPL_HVM) %>%
  #Take out types of hospitals and nursing homes
  select(-count_children, -count_criticalaccess, -count_generalacutecare, -count_longtermcare,
         -count_military, -count_psychiatric, -count_rehab, -count_special, -count_women,
         -count_assisted_living, -count_nursing_home,-count_NA) %>%
  #Take out categories with very little data 
  select(-PROP_AIAN, -PROP_TWOMORE, -PROP_OTHERRACE, -PROP_MUNIT, -PROP_GROUPQ, 
         -PROP_NHPI) %>%
  #Take out categories including total when subtypes are present
  select(-TotalEncounters, -PROP_MINRTY) %>%
  #Sum blactam_norm and Carbapenems_norm to create one category for bla use
  mutate(Bla_norm = rowSums(select(., blactam_norm, Carbapenems_norm), 
                            na.rm = TRUE)) %>%
  select(-Carbapenems_norm, -blactam_norm, -Colistin_norm)

#Reorder
data_ARG_all <- data_ARG_all[, c(1:4, 35:37, #Site info
                                 5:7, 9,8, #AR Burden
                                 40,38:39, #ABD use
                                 14:16, #Animals
                                 23,22, #Age
                                 17:19, 21,30:33, #Financial burden
                                 20,24,25,26, #Social vulnerability
                                 27:29, #Race/Ethnicity
                                 11:13,10,34)]#Points of interest

#Calculate Spearman correlation coefficients
cor_matrix_all_z <- as.data.frame(cor(data_ARG_all[,8:35],
                  use = "na.or.complete",
                  method = "spearman")) %>%
  select(-Burden_all, -Burden_bla, -Burden_col, -Burden_van, -Burden_tet) %>%
  slice_head(n = 5)

p_matrix_all_z <- as.data.frame(cor.mtest(data_ARG_all[,8:35],
                  use = "na.or.complete",
                  method = "spearman",
                  conf.level = 0.95)$p) %>%
  select(-Burden_all, -Burden_bla, -Burden_col, -Burden_van, -Burden_tet) %>%
  slice_head(n = 5)  

#Correlation plot for ARG as z-scores
pdf("Fig_ARBall_Corr.pdf")
corrplot(as.matrix(cor_matrix_all_z),
         method = "ellipse",
         tl.col = "black",
         tl.srt = 45,
         p.mat = as.matrix(p_matrix_all_z),
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG z-score and secondary dataset",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()

#Adjust for p-value
p_adj_all_z <- t(apply(as.matrix(p_matrix_all_z), 
                       MARGIN = 1, 
                       FUN = function(x) p.adjust(x, method = "BH", n = 24)))

#Correlation plot for ARG as z-scores
pdf("Fig_ARBAll_Corr_adj.png")
corrplot(as.matrix(cor_matrix_all_z),
         method = "ellipse",
         tl.col = "black",
         tl.srt = 45,
         p.mat = p_adj_all_z,
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG z-score and secondary dataset",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()

```

For points of interest, urbanicity, and population density, we're regarding these variables as binary so the comparison becomes categorical. 

```{r comparison_categorical}
#Wide data frame for variables needed 
data_ARG_cat <- data_ARG_all %>% 
  select (1:12, 36:40)

#Making hospital number categorical
data_ARG_cat_abv <- filter(data_ARG_cat, total_hospitals >= 1)
data_ARG_cat_bel <- filter(data_ARG_cat, total_hospitals < 1)

data_ARG_cat_abv$hospital <- "1+"
data_ARG_cat_bel$hospital <- "< 1"

data_ARG_cat <- rbind(data_ARG_cat_abv, data_ARG_cat_bel)

#Making nursing home categorical 
data_ARG_cat_abv <- filter(data_ARG_cat, total_nursing >= 7)
data_ARG_cat_bel <- filter(data_ARG_cat, total_nursing < 7)

data_ARG_cat_abv$nursing <- "7+"
data_ARG_cat_bel$nursing <- "< 7"

data_ARG_cat <- rbind(data_ARG_cat_abv, data_ARG_cat_bel)

#Making airport categorical 
data_ARG_cat_abv <- filter(data_ARG_cat, total_airports > 0)
data_ARG_cat_bel <- filter(data_ARG_cat, total_airports == 0)

data_ARG_cat_abv$airport <- "Yes"
data_ARG_cat_bel$airport <- "No"

data_ARG_cat <- rbind(data_ARG_cat_abv, data_ARG_cat_bel)

#Making urban proportion categorical 
data_ARG_cat_abv <- filter(data_ARG_cat, urban_prop >= 0.5)
data_ARG_cat_bel <- filter(data_ARG_cat, urban_prop < 0.5)
data_ARG_cat_abv$urban <- "Yes"
data_ARG_cat_bel$urban <- "No"

data_ARG_cat <- rbind(data_ARG_cat_abv, data_ARG_cat_bel)

#Making population density categorical 
data_ARG_cat_abv <- filter(data_ARG_cat, pop_km2_county >= 617)
data_ARG_cat_bel <- filter(data_ARG_cat, pop_km2_county < 617)
data_ARG_cat_abv$pop_dense <- "Yes"
data_ARG_cat_bel$pop_dense <- "No"

data_ARG_cat <- rbind(data_ARG_cat_abv, data_ARG_cat_bel)

#Making data long
data_ARG_cat_long <- pivot_longer(data_ARG_cat, cols = hospital:pop_dense,
                                  names_to = "Facility",
                                  values_to = "Count")

#For total ARG burden
Fig_TotARGcat_box <-
ggplot(data_ARG_cat_long, aes(x = Count, y = Burden_all)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

#Wilcox test to see if there's significant difference between two groups
wilcox.test(Burden_all ~ Count, data = subset(data_ARG_cat_long, Facility == "airport"))
wilcox.test(Burden_all ~ Count, data = subset(data_ARG_cat_long, Facility == "hospital"),
            conf.int = TRUE)
wilcox.test(Burden_all ~ Count, data = subset(data_ARG_cat_long, Facility == "nursing"),
            conf.int = TRUE)
wilcox.test(Burden_all ~ Count, data = subset(data_ARG_cat_long, Facility == "pop_dense"))
wilcox.test(Burden_all ~ Count, data = subset(data_ARG_cat_long, Facility == "urban"))

p_cat_all <- c(wilcox.test(Burden_all ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(Burden_all ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(Burden_all ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(Burden_all ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(Burden_all ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "urban"))$p.value)

p_cat_all_adj <- p.adjust(p_cat_all, method = "BH")
p_cat_all_adj

#Statistics (effect size and degree of freedom)
subset(data_ARG_cat_long, Facility == "hospital") %>% wilcox_effsize(Burden_all ~ Count)
sum(!is.na(subset(data_ARG_cat_long, Facility == "hospital")$Burden_all))-1

subset(data_ARG_cat_long, Facility == "nursing") %>% wilcox_effsize(Burden_all ~ Count)
sum(!is.na(subset(data_ARG_cat_long, Facility == "nursing")$Burden_all))-1

#For total Bla burden
Fig_blaARGcat_box <-
ggplot(data_ARG_cat_long, aes(x = Count, y = Burden_bla)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_bla <- c(wilcox.test(Burden_bla ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "airport"))$p.value,
               wilcox.test(Burden_bla ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(Burden_bla ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(Burden_bla ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(Burden_bla ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "urban"))$p.value)

p_cat_bla_adj <- p.adjust(p_cat_bla, method = "BH")
p_cat_bla_adj

#For total colistin burden
Fig_colARGcat_box <-
ggplot(data_ARG_cat_long, aes(x = Count, y = Burden_col)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_col <- c(wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "airport"))$p.value,
               wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "urban"))$p.value)

p_cat_col_adj <- p.adjust(p_cat_col, method = "BH")
p_cat_col_adj

#Wilcox test and statistics
wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "airport"), conf.int = TRUE)
subset(data_ARG_cat_long, Facility == "airport") %>% wilcox_effsize(Burden_col ~ Count)
sum(!is.na(subset(data_ARG_cat_long, Facility == "airport")$Burden_col))-1

wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "nursing"), conf.int = TRUE)
subset(data_ARG_cat_long, Facility == "nursing") %>% wilcox_effsize(Burden_col ~ Count)
sum(!is.na(subset(data_ARG_cat_long, Facility == "nursing")$Burden_col))-1

wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "pop_dense"), conf.int = TRUE)
subset(data_ARG_cat_long, Facility == "pop_dense") %>% wilcox_effsize(Burden_col ~ Count)
sum(!is.na(subset(data_ARG_cat_long, Facility == "pop_dense")$Burden_col))-1

wilcox.test(Burden_col ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "urban"), conf.int = TRUE)
subset(data_ARG_cat_long, Facility == "urban") %>% wilcox_effsize(Burden_col ~ Count)
sum(!is.na(subset(data_ARG_cat_long, Facility == "urban")$Burden_col))-1

#For total tetracycline burden
Fig_tetARGcat_box <-
ggplot(data_ARG_cat_long, aes(x = Count, y = Burden_tet)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  ylim(-0.12, 0.15) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_tet <- c(wilcox.test(Burden_tet ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "airport"))$p.value,
               wilcox.test(Burden_tet ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(Burden_tet ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(Burden_tet ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(Burden_tet ~ Count, 
                           data = subset(data_ARG_cat_long, Facility == "urban"))$p.value)

p_cat_tet_adj <- p.adjust(p_cat_tet, method = "BH")
p_cat_tet_adj

#For total vancomycin burden
#Fig_vanARGcat_box <-
ggplot(data_ARG_cat_long, aes(x = Count, y = Burden_van)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
#  ylim(-0.17, 0.6) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

#In concentration instead of z-score to visualize better
data_van <- select(data_11_wide, site, plant, city, state, 
                   VanA)

data_van_cat <- merge(data_van, 
                      select(data_ARG_cat, 
                             site, plant, city, state, 
                             urban, hospital, nursing, airport, pop_dense), 
                      by = c("site", "plant", "city", "state")) 

#Making data long
data_van_cat_long <- pivot_longer(data_van_cat, cols = urban:pop_dense,
                                  names_to = "Facility",
                                  values_to = "Count")
Fig_vanARGcat_box <-
ggplot(data_van_cat_long, aes(x = Count, y = VanA)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_van <- c(wilcox.test(VanA ~ Count, 
                           data = subset(data_van_cat_long, Facility == "airport"))$p.value,
               wilcox.test(VanA ~ Count, 
                           data = subset(data_van_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(VanA ~ Count, 
                           data = subset(data_van_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(VanA ~ Count, 
                           data = subset(data_van_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(VanA ~ Count, 
                           data = subset(data_van_cat_long, Facility == "urban"))$p.value)

p_cat_van_adj <- p.adjust(p_cat_van, method = "BH")
p_cat_van_adj

ggsave(Fig_TotARGcat_box, file = "Fig_TotARGcat_box.pdf", width = 5, height = 2)
ggsave(Fig_blaARGcat_box, file = "Fig_blaARGcat_box.pdf", width = 5, height = 2)
ggsave(Fig_colARGcat_box, file = "Fig_colARGcat_box.pdf", width = 5, height = 2)
ggsave(Fig_tetARGcat_box, file = "Fig_tetARGcat_box.pdf", width = 5, height = 2)
ggsave(Fig_vanARGcat_box, file = "Fig_vanARGcat_box.pdf", width = 5, height = 2)

```

Looking a little closer at the beta-lactamase genes:

```{r corrplot_bla}
#Wide data frame for variables needed 
data_bla <- select(data_11_wide, site, plant, city, state, 
                   CMY, `CTX-M`, KPC, MecA, NDM, `OXA-48`, TEM, VIM)

data_bla_all <- merge(data_bla, 
                      select(data_ARG_all, 
                             -Burden_all, -Burden_bla, -Burden_col, -Burden_tet, -Burden_van), 
                      by = c("site", "plant", "city", "state")) %>%
  select(-County, -Region, -Division)

#Calculate Spearman correlation coefficients
cor_matrix_bla <- as.data.frame(cor(data_bla_all[,5:35],
                  use = "na.or.complete",
                  method = "spearman")) %>%
  select(-CMY, -`CTX-M`, -KPC, -MecA, -NDM, -`OXA-48`, -TEM, -VIM) %>%
  slice_head(n = 8)

p_matrix_bla <- as.data.frame(cor.mtest(data_bla_all[,5:35],
                  use = "na.or.complete",
                  method = "spearman",
                  conf.level = 0.95)$p) %>%
  select(-CMY, -`CTX-M`, -KPC, -MecA, -NDM, -`OXA-48`, -TEM, -VIM) %>%
  slice_head(n = 8)  

#Correlation plot for ARG as concentration
pdf("Fig_blaAll_Corr.pdf")
corrplot(as.matrix(cor_matrix_bla),
         method = "ellipse",
         tl.col = "black",
         tl.srt = 45,
         p.mat = as.matrix(p_matrix_bla),
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among bla concentration and secondary dataset",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()

#Adjust for p-value
p_adj_bla <- t(apply(as.matrix(p_matrix_bla), 
                     MARGIN = 1, 
                     FUN = function(x) p.adjust(x, method = "BH", n = 24)))

#Correlation plot for ARG as z-scores
pdf("Fig_blaAll_Corr_adj.pdf")
corrplot(as.matrix(cor_matrix_bla),
         method = "ellipse",
         tl.col = "black",
         tl.srt = 45,
         p.mat = p_adj_bla,
         sig.level = 0.05,
         insig = "blank", 
         addCoef.col = "black", 
         number.cex = 0.5, 
         title = "Correlation among ARG z-score and secondary dataset",
         mar = c(0,0,2,0),
         cex.main = 0.8)
dev.off()
```

Looking at the same categorical variables as before: 

```{r categorical_bla}
data_bla_cat <- merge(data_bla, 
                      select(data_ARG_cat, 
                             site, plant, city, state, 
                             urban, hospital, nursing, airport, pop_dense), 
                      by = c("site", "plant", "city", "state")) 

#Making data long
data_bla_cat_long <- pivot_longer(data_bla_cat, cols = urban:pop_dense,
                                  names_to = "Facility",
                                  values_to = "Count")

#For NDM 
Fig_NDMcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = NDM)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_NDM <- c(wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_NDM_adj <- p.adjust(p_cat_NDM, method = "BH")
p_cat_NDM_adj

wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"), conf.int = TRUE)
subset(data_bla_cat_long, Facility == "airport") %>% wilcox_effsize(NDM ~ Count)
sum(!is.na(subset(data_bla_cat_long, Facility == "airport")$NDM))-1

wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"), conf.int = TRUE)
subset(data_bla_cat_long, Facility == "hospital") %>% wilcox_effsize(NDM ~ Count)
sum(!is.na(subset(data_bla_cat_long, Facility == "hospital")$NDM))-1

wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"), conf.int = TRUE)
subset(data_bla_cat_long, Facility == "nursing") %>% wilcox_effsize(NDM ~ Count)
sum(!is.na(subset(data_bla_cat_long, Facility == "nursing")$NDM))-1

wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"), conf.int = TRUE)
subset(data_bla_cat_long, Facility == "pop_dense") %>% wilcox_effsize(NDM ~ Count)
sum(!is.na(subset(data_bla_cat_long, Facility == "pop_dense")$NDM))-1

wilcox.test(NDM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"), conf.int = TRUE)
subset(data_bla_cat_long, Facility == "urban") %>% wilcox_effsize(NDM ~ Count)
sum(!is.na(subset(data_bla_cat_long, Facility == "urban")$NDM))-1

#CMY
Fig_CMYcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = CMY)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_CMY <- c(wilcox.test(CMY ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(CMY ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(CMY ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(CMY ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(CMY ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_CMY_adj <- p.adjust(p_cat_CMY, method = "BH")
p_cat_CMY_adj

wilcox.test(CMY ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"), conf.int = TRUE)
subset(data_bla_cat_long, Facility == "urban") %>% wilcox_effsize(CMY ~ Count)
sum(!is.na(subset(data_bla_cat_long, Facility == "urban")$CMY))-1

#CTX-M
Fig_CTXMcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = `CTX-M`)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_CTXM <- c(wilcox.test(`CTX-M` ~ Count, 
                            data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(`CTX-M` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(`CTX-M` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(`CTX-M` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(`CTX-M` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_CTXM_adj <- p.adjust(p_cat_CTXM, method = "BH")
p_cat_CTXM_adj

#KPC
Fig_KPCcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = KPC)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_KPC <- c(wilcox.test(KPC ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(KPC ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(KPC ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(KPC ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(KPC ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_KPC_adj <- p.adjust(p_cat_KPC, method = "BH")
p_cat_KPC_adj

#MecA
Fig_MecAcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = MecA)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_MecA <- c(wilcox.test(MecA ~ Count, 
                            data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(MecA ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(MecA ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(MecA ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(MecA ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_MecA_adj <- p.adjust(p_cat_MecA, method = "BH")
p_cat_MecA_adj

#OXA-48
Fig_OXAcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = `OXA-48`)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_OXA <- c(wilcox.test(`OXA-48` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(`OXA-48` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(`OXA-48` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(`OXA-48` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(`OXA-48` ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_OXA_adj <- p.adjust(p_cat_OXA, method = "BH")
p_cat_OXA_adj

#TEM
Fig_TEMcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = TEM)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_TEM <- c(wilcox.test(TEM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(TEM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(TEM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(TEM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(TEM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_TEM_adj <- p.adjust(p_cat_TEM, method = "BH")
p_cat_TEM_adj

#Vim
Fig_VIMcat_box <-
ggplot(data_bla_cat_long, aes(x = Count, y = VIM)) +
  geom_jitter(size = 0.3, alpha = 0.9, color = "darkgrey") +
  geom_boxplot(alpha = 0.5, outlier.shape = NA) +
  facet_wrap(vars(Facility), scales = "free", nrow = 1) +
  scale_y_continuous(trans = 'log10', labels = function(x) format(x, scientific = TRUE)) +
  theme(legend.position = "none", axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme_light()

p_cat_VIM <- c(wilcox.test(VIM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "airport"))$p.value, 
               wilcox.test(VIM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "hospital"))$p.value,
               wilcox.test(VIM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "nursing"))$p.value,
               wilcox.test(VIM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "pop_dense"))$p.value,
               wilcox.test(VIM ~ Count, 
                           data = subset(data_bla_cat_long, Facility == "urban"))$p.value)

p_cat_VIM_adj <- p.adjust(p_cat_VIM, method = "BH")
p_cat_VIM_adj

ggsave(Fig_CMYcat_box, file = "Fig_CMYcat_box.pdf", width = 5, height = 2)
ggsave(Fig_CTXMcat_box, file = "Fig_CTXMcat_box.pdf", width = 5, height = 2)
ggsave(Fig_KPCcat_box, file = "Fig_KPCcat_box.pdf", width = 5, height = 2)
ggsave(Fig_MecAcat_box, file = "Fig_MecAcat_box.pdf", width = 5, height = 2)
ggsave(Fig_NDMcat_box, file = "Fig_NDMcat_box.pdf", width = 5, height = 2)
ggsave(Fig_OXAcat_box, file = "Fig_OXAcat_box.pdf", width = 5, height = 2)
ggsave(Fig_TEMcat_box, file = "Fig_TEMcat_box.pdf", width = 5, height = 2)
ggsave(Fig_VIMcat_box, file = "Fig_VIMcat_box.pdf", width = 5, height = 2)
```


## 3.5 Geographic trends: census region

Plotting distribution of ARGs by census regions: 

```{r geo_dist, fig.width = 10, fig.height = 2}
#Distribution when normalized by 16S 
ggplot(data_all_3, aes(x = target, y = mean_ARG_S, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.5, alpha = 0.9) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_y_continuous(trans = 'log10') + 
  scale_shape_manual(values = c(19, 1)) +
  ylab("Conc (-)") + 
  theme_bw() +
  labs(title = "ARG distribution normalized by 16S")

#Total ARG burden when concentrations are summed 
#plot_burden_all_conc <- 
  ggplot(data_burden_add, aes(x = Region, y = Burden_all, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.5, alpha = 0.9) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_y_continuous(trans = 'log10') + 
  scale_shape_manual(values = c(19, 1)) +
  ylab("Normalized ARG Concentration Summed") + 
  theme_bw() +
  labs(title = "Total ARG burden")

#Total ARG burden when z-scores are summed
#plot_burden_all_z <- 
  ggplot(data_burden_mer, aes(x = Region, y = Burden_all, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.5, alpha = 0.9) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_shape_manual(values = c(19, 1)) +
  ylab("Summed z-score") + 
  theme_bw() + 
  labs(title = "Total ARG burden")

#Burden by geography 
data_burden_long <- pivot_longer(select(data_burden_mer, city:Burden_tet, Region),
                                 cols = Burden_all:Burden_tet,
                                 names_to = "Burden",
                                 values_to = "zscore")

#Burden by type 
Fig_ARB_Region <- 
  ggplot(subset(data_burden_long, Burden == "Burden_all" | Burden == "Burden_bla"), 
         aes(x = Burden, y = zscore, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.5) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_shape_manual(values = c(19, 1)) +
  ylab("Burden score") + 
  scale_fill_manual(values = c("#4f5dae", "#c097c6", "#2fa4bb", "#3fbd71")) +
  ylim(-5,7) + 
  theme_bw() + 
  theme(legend.position = "none")
  
ggsave(Fig_ARB_Region, file = "Fig_ARB_Region.pdf", width = 2, height = 2)

#Zoomed version to visualize colistin, tetracycline, and vancomycin burden better
Fig_ARB_Region_zoom <- 
  ggplot(data_burden_long, aes(x = Burden, y = zscore, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.5) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_shape_manual(values = c(19, 1)) +
  ylab("Burden score") + 
  scale_fill_manual(values = c("#4f5dae", "#c097c6", "#2fa4bb", "#3fbd71")) +
  ylim(-0.7,2) + 
  theme_bw()
  
ggsave(Fig_ARB_Region_zoom, file = "Fig_ARB_Region_zoom.pdf", width = 5, height = 2)

#For beta-lactamase resistance genes
Fig_ARGsub_Region <- 
ggplot(subset(subset(data_all_2, target == "CTX-M" | target == "KPC" | 
                       target == "NDM" | target == "VIM" | target == "MCR-1" | 
                       target == "TetW" | target == "VanA"), !is.na(zscore)), 
       aes(x = target, y = mean_ARG_S, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.5) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_y_continuous(trans = 'log10') + 
  scale_shape_manual(values = c(19, 1)) +
  ylab("Conc (-)") + 
  theme_bw() +
    scale_fill_manual(values = c("#4f5dae", "#c097c6", "#2fa4bb", "#3fbd71"))

ggsave(Fig_ARGsub_Region, file = "Fig_ARGsub_Region.pdf", width = 7, height = 2)

#All ARGs
Fig_ARG_Region <- 
ggplot(data_all_3, aes(x = target, y = mean_ARG_S, fill = Region)) + 
  geom_jitter(color = "darkgrey", size = 0.2) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  scale_y_continuous(trans = 'log10') + 
  scale_shape_manual(values = c(19, 1)) +
  ylab("Concentration (-)") +
  xlab("Target") +
  theme_bw() +
  scale_fill_manual(values = c("#4f5dae", "#c097c6", "#2fa4bb", "#3fbd71")) +
  theme(legend.position = "top")
  

ggsave(Fig_ARG_Region, file = "Fig_ARG_Region.pdf", width = 6.5, height = 3)

```

We can do a Kruskal-Wallis test to see if there is a significant difference in at least one of the groups. 

```{r geo_kw}
#Kruskal-Wallis test for each ARG
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "CMY"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "CTX-M"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "KPC"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "MCR-1"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "MecA"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "NDM"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "OXA-48"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "TEM"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "TetW"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "VanA"))
kruskal.test(mean_ARG_S ~ Region, data = subset(data_all_3, target == "VIM"))

#Kruskal wallis on overall ARG burden of the region 
kruskal.test(Burden_all ~ Region, data = data_burden_add)
kruskal.test(Burden_all ~ Region, data = data_burden_mer)

#Kruskal wallis on different class of antibiotic resistance burden of the region
kruskal.test(Burden_bla ~ Region, data = data_burden_mer)
kruskal.test(Burden_col ~ Region, data = data_burden_mer)
kruskal.test(Burden_tet ~ Region, data = data_burden_mer)
kruskal.test(Burden_van ~ Region, data = data_burden_mer)
```

Kruskal-Wallis shows that mecA, TetW, VIM is not statistically different (p > 0.05) but the rest are statistically different (p < 0.05). So we can do a Conover Iman posthoc test to see pairwise difference. 

```{r geo_conover}
#Conover Iman posthoc test
conover.test(subset(data_all_3, target == "CMY")$mean_ARG_S, 
             subset(data_all_3, target == "CMY")$Region,
             method = "BH")

conover.test(subset(data_all_3, target == "CTX-M")$mean_ARG_S, 
             subset(data_all_3, target == "CTX-M")$Region,
             method = "BH")

conover.test(subset(data_all_3, target == "KPC")$mean_ARG_S, 
             subset(data_all_3, target == "KPC")$Region,
             method = "BH")

conover.test(subset(data_all_3, target == "MCR-1")$mean_ARG_S, 
             subset(data_all_3, target == "MCR-1")$Region,
             method = "Bonferroni")

conover.test(subset(data_all_3, target == "NDM")$mean_ARG_S, 
             subset(data_all_3, target == "NDM")$Region,
             method = "BH")

conover.test(subset(data_all_3, target == "OXA-48")$mean_ARG_S, 
             subset(data_all_3, target == "OXA-48")$Region,
             method = "Bonferroni")

conover.test(subset(data_all_3, target == "TEM")$mean_ARG_S, 
             subset(data_all_3, target == "TEM")$Region,
             method = "Bonferroni")

conover.test(subset(data_all_3, target == "VanA")$mean_ARG_S, 
             subset(data_all_3, target == "VanA")$Region,
             method = "Bonferroni")

conover.test(data_burden_mer$Burden_all, data_burden_mer$Region, 
             method = "BH")

conover.test(data_burden_mer$Burden_bla, data_burden_mer$Region,
             method = "BH")

conover.test(data_burden_mer$Burden_col, data_burden_mer$Region,
             method = "BH")

conover.test(data_burden_mer$Burden_van, data_burden_mer$Region,
             method = "BH")

```
